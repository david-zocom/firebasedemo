<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Firebase DB test">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Firebase Database test</title>

	<style>
		body > div {
			border: 1px solid darkgray;
			background-color: antiquewhite;
		}
		div {
			border: 1px solid lightgray;
			border-radius: 8px;
			padding: 8px;
			margin: 4px;
		}
	</style>
	<script src="https://www.gstatic.com/firebasejs/3.7.1/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
		apiKey: "AIzaSyD08rUvwXqekM8YoFhQjGWbV7o3g5r6VvQ",
		authDomain: "myproject-f7ec9.firebaseapp.com",
		databaseURL: "https://myproject-f7ec9.firebaseio.com",
		storageBucket: "myproject-f7ec9.appspot.com",
		messagingSenderId: "133847088463"
		};
		firebase.initializeApp(config);
	</script>

</head>
<body>
	<h1>Awesomesauce</h1>
	<div>Hello wrldOOO</div>
	<div id="select-all">Select all</div>
	
	<p>
		Skriv in ett intressant ord! <br>
		<input type="text" id="inputWord" placeholder="Skriv in ett ord"/> <br>
		<input type="text" id="inputDescribe" placeholder="Förklara varför det är intressant"/> <br>
		<button id="btnSaveWord">Spara ord i databasen</button>
	</p>
	
	<div id="messages"><strong>Meddelanden</strong></div>
	
	
	<script type="text/javascript">
		// Hjälpfunktion
		function addMessage(msg) {
			let msgDiv = document.getElementById('messages');
			msgDiv.innerHTML += `<div>${msg}</div> `;
		}
		
		// Spara intressant ord till databasen
		let iWord = document.getElementById('inputWord');
		let iDescribe = document.getElementById('inputDescribe');
		let bSaveWord = document.getElementById('btnSaveWord');
		bSaveWord.addEventListener('click', function(event) {
			let word = iWord.innerHTML;
			let text = iDescribe.innerHTML;
			firebase.database().ref('words/' + word).set({
				text: text
			});
			addMessage(`Sparar ${word}=${text} i databasen...`);
		});
		
		//firebase.date
		
		let posts = firebase.database().ref('posts/');
		
		// Event listener used to read from database
		posts.on('value', function(snapshot) {
			// Event listener is activated when loaded and
			// every time the database changes
			addMessage('Databasen laddades eller ändrades.');
			let value = snapshot.val();
			//console.log(value);
			for( let p in value ) {
				//console.log('post:', value[p]);
				displayPost(value[p]);
			}
		}, function(errorObject) {
			console.log('the read failed: ' + errorObject.code);
		});

		let out = document.getElementById('select-all');
		function displayPost(p) {
			let div = document.createElement('div');
			let span = document.createElement('span');
			span.innerHTML = `Author: ${p.author} <br>`;
			//let img = document.createElement('img');
			//img.src = p.authorPic;
			let span2 = document.createElement('span');
			span2.innerHTML = `<strong>${p.title}</strong><br>${p.body}`;
			div.appendChild(span);
			//div.appendChild(img);
			div.appendChild(span2);
			out.appendChild(div);
		}
	</script>
</body>
</html>
